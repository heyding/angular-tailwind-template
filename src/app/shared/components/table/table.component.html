<div class="w-full">
  <!-- Filter -->
  @if (config.filtering?.enabled) {
    <div class="mb-4">
      <input
        type="text"
        [placeholder]="config.filtering?.placeholder || 'Search...'"
        (input)="onFilter($event)"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
    </div>
  }

  <!-- Table -->
  <div class="overflow-x-auto bg-white rounded-lg shadow">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          @if (config.selection?.enabled) {
            <th class="px-6 py-3 w-12"></th>
          }
          @for (column of columns; track column.key) {
            <th
              [class]="
                'px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider ' +
                (column.align === 'center'
                  ? 'text-center'
                  : column.align === 'right'
                    ? 'text-right'
                    : 'text-left') +
                (column.sortable && config.sorting?.enabled ? ' cursor-pointer select-none' : '')
              "
              [style.width]="column.width"
              (click)="onSort(column)"
            >
              <div class="flex items-center gap-2">
                <span>{{ column.label }}</span>
                @if (column.sortable && config.sorting?.enabled) {
                  <span class="flex flex-col">
                    <svg
                      class="w-3 h-3"
                      [class.text-blue-600]="sortColumn === column.key && sortDirection === 'asc'"
                      [class.text-gray-400]="sortColumn !== column.key || sortDirection !== 'asc'"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path d="M10 3l-7 7h14l-7-7z" />
                    </svg>
                    <svg
                      class="w-3 h-3 -mt-1"
                      [class.text-blue-600]="sortColumn === column.key && sortDirection === 'desc'"
                      [class.text-gray-400]="sortColumn !== column.key || sortDirection !== 'desc'"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path d="M10 17l7-7H3l7 7z" />
                    </svg>
                  </span>
                }
              </div>
            </th>
          }
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        @if (loading) {
          <tr>
            <td
              [attr.colspan]="columns.length + (config.selection?.enabled ? 1 : 0)"
              class="px-6 py-12 text-center"
            >
              <div class="flex justify-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
              </div>
            </td>
          </tr>
        } @else if (paginatedData.length === 0) {
          <tr>
            <td
              [attr.colspan]="columns.length + (config.selection?.enabled ? 1 : 0)"
              class="px-6 py-12 text-center text-gray-500"
            >
              {{ 'table.noData' | translate }}
            </td>
          </tr>
        } @else {
          @for (row of paginatedData; track row) {
            <tr
              [class.bg-blue-50]="isRowSelected(row)"
              [class.hover:bg-gray-50]="!isRowSelected(row)"
              [class.cursor-pointer]="config.selection?.enabled"
              (click)="toggleRowSelection(row)"
            >
              @if (config.selection?.enabled) {
                <td class="px-6 py-4">
                  <input
                    type="checkbox"
                    [checked]="isRowSelected(row)"
                    class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                    (click)="$event.stopPropagation()"
                  />
                </td>
              }
              @for (column of columns; track column.key) {
                <td
                  [class]="
                    'px-6 py-4 whitespace-nowrap text-sm ' +
                    (column.align === 'center'
                      ? 'text-center'
                      : column.align === 'right'
                        ? 'text-right'
                        : 'text-left')
                  "
                >
                  {{ getCellValue(row, column) }}
                </td>
              }
            </tr>
          }
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  @if (config.pagination?.enabled && !loading) {
    <div class="mt-4 flex items-center justify-between">
      <div class="flex items-center gap-2 text-sm text-gray-700">
        <span
          >{{ 'table.showing' | translate }} {{ showingFrom }} {{ 'table.to' | translate }}
          {{ showingTo }} {{ 'table.of' | translate }} {{ filteredData.length }}</span
        >
        @if (config.pagination?.pageSizeOptions && config.pagination?.pageSizeOptions!.length > 1) {
          <select
            [value]="pageSize"
            (change)="onPageSizeChange($event)"
            class="ml-2 px-3 py-1 pr-8 border border-gray-300 rounded appearance-none bg-white cursor-pointer"
            style="
              background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22currentColor%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22%3e%3cpolyline points=%226 9 12 15 18 9%22%3e%3c/polyline%3e%3c/svg%3e');
              background-repeat: no-repeat;
              background-position: right 0.5rem center;
              background-size: 1rem;
            "
          >
            @for (option of config.pagination?.pageSizeOptions!; track option) {
              <option [value]="option">{{ option }}</option>
            }
          </select>
          <span>{{ 'table.perPage' | translate }}</span>
        }
      </div>

      <div class="flex gap-1">
        <button
          (click)="onPageChange(currentPage - 1)"
          [disabled]="currentPage === 0"
          class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          ←
        </button>

        @for (page of pages; track page) {
          @if (page < 3 || page > totalPages - 4 || Math.abs(page - currentPage) < 2) {
            <button
              (click)="onPageChange(page)"
              [class.bg-blue-600]="currentPage === page"
              [class.text-white]="currentPage === page"
              [class.border-blue-600]="currentPage === page"
              class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50"
            >
              {{ page + 1 }}
            </button>
          } @else if (page === 3 || page === totalPages - 4) {
            <span class="px-2 py-1">...</span>
          }
        }

        <button
          (click)="onPageChange(currentPage + 1)"
          [disabled]="currentPage >= totalPages - 1"
          class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          →
        </button>
      </div>
    </div>
  }
</div>
